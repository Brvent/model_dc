Version 4.1
SHEET 1 3268 1092
WIRE -1184 -80 -1184 -96
WIRE -912 -80 -912 -96
WIRE 96 -32 -32 -32
WIRE 160 -32 96 -32
WIRE 304 -32 224 -32
WIRE 352 -32 304 -32
WIRE 480 -32 416 -32
WIRE -1184 0 -1184 -80
WIRE -1056 0 -1184 0
WIRE -912 0 -912 -80
WIRE -800 0 -912 0
WIRE -1184 32 -1184 0
WIRE -912 32 -912 0
WIRE 752 48 752 0
WIRE -1056 64 -1056 0
WIRE -800 64 -800 0
WIRE 304 64 304 -32
WIRE 96 128 96 -32
WIRE 176 128 96 128
WIRE 528 128 432 128
WIRE 704 128 608 128
WIRE -1184 160 -1184 112
WIRE -1056 160 -1056 144
WIRE -912 160 -912 112
WIRE -800 160 -800 144
WIRE 1504 160 1296 160
WIRE 1648 160 1584 160
WIRE 1744 160 1680 160
WIRE 1808 160 1744 160
WIRE 2080 160 1888 160
WIRE 2512 160 2384 160
WIRE 2720 160 2576 160
WIRE 480 176 480 -32
WIRE 752 176 752 144
WIRE 752 176 480 176
WIRE 912 176 752 176
WIRE 1072 176 1072 128
WIRE 2928 176 2800 176
WIRE 3056 176 2992 176
WIRE 2720 192 2704 192
WIRE -32 208 -176 208
WIRE 176 208 48 208
WIRE 480 208 480 176
WIRE 480 208 432 208
WIRE 752 208 752 176
WIRE -672 224 -720 224
WIRE 2544 224 2544 192
WIRE 2544 224 2528 224
WIRE -496 240 -592 240
WIRE -384 240 -496 240
WIRE -672 256 -768 256
WIRE 1744 256 1744 160
WIRE 2096 256 1744 256
WIRE -496 272 -496 240
WIRE 3056 272 3056 176
WIRE -32 288 -176 288
WIRE 176 288 48 288
WIRE 528 288 432 288
WIRE 704 288 608 288
WIRE 1072 288 1072 256
WIRE 2704 288 2704 192
WIRE 2704 288 2688 288
WIRE 2896 288 2832 288
WIRE 1664 304 1664 176
WIRE 2096 304 1664 304
WIRE 3024 304 2976 304
WIRE -1008 320 -1008 304
WIRE 752 320 752 304
WIRE 2896 320 2848 320
WIRE 2848 368 2848 320
WIRE 2928 368 2848 368
WIRE -496 384 -496 352
WIRE 2848 400 2848 368
WIRE -672 416 -720 416
WIRE -1008 432 -1008 400
WIRE -496 432 -592 432
WIRE -384 432 -496 432
WIRE 304 432 304 352
WIRE 752 432 752 400
WIRE 2928 432 2928 368
WIRE -672 448 -768 448
WIRE -496 464 -496 432
WIRE 1056 464 1056 432
WIRE 1360 480 1296 480
WIRE 1584 480 1424 480
WIRE 1808 496 1664 496
WIRE 1584 512 1552 512
WIRE 2096 512 1888 512
WIRE 1392 528 1392 512
WIRE 1392 528 1296 528
WIRE 1808 528 1760 528
WIRE 2848 560 2848 464
WIRE 3056 560 3056 336
WIRE 3056 560 2848 560
WIRE -496 576 -496 544
WIRE 96 576 -32 576
WIRE 160 576 96 576
WIRE 304 576 224 576
WIRE 352 576 304 576
WIRE 480 576 416 576
WIRE 1056 592 1056 544
WIRE 1552 592 1552 512
WIRE 1552 592 1296 592
WIRE -672 608 -720 608
WIRE 2848 608 2848 560
WIRE 2848 608 2368 608
WIRE 2912 608 2880 608
WIRE -496 624 -592 624
WIRE -384 624 -496 624
WIRE 1760 624 1760 528
WIRE 2096 624 1760 624
WIRE -672 640 -768 640
WIRE -496 640 -496 624
WIRE 752 656 752 608
WIRE 304 672 304 576
WIRE 2096 672 1664 672
WIRE 2576 672 2368 672
WIRE 2848 672 2848 608
WIRE 2848 672 2640 672
WIRE 1664 704 1664 672
WIRE -1248 720 -1248 688
WIRE -1136 720 -1136 688
WIRE -1024 720 -1024 688
WIRE -928 720 -928 688
WIRE 96 736 96 576
WIRE 176 736 96 736
WIRE 528 736 432 736
WIRE 704 736 608 736
WIRE 2880 736 2880 608
WIRE 2880 736 2368 736
WIRE -496 752 -496 720
WIRE 480 784 480 576
WIRE 752 784 752 752
WIRE 752 784 480 784
WIRE 912 784 752 784
WIRE -672 800 -720 800
WIRE 2864 800 2368 800
WIRE 2976 800 2864 800
WIRE -496 816 -592 816
WIRE -384 816 -496 816
WIRE -32 816 -176 816
WIRE 176 816 48 816
WIRE 480 816 480 784
WIRE 480 816 432 816
WIRE 752 816 752 784
WIRE 1664 816 1664 784
WIRE 2864 816 2864 800
WIRE 2976 816 2976 800
WIRE -672 832 -768 832
WIRE -496 832 -496 816
WIRE -32 896 -176 896
WIRE 176 896 48 896
WIRE 528 896 432 896
WIRE 704 896 608 896
WIRE 2464 896 2368 896
WIRE 752 928 752 912
WIRE 2864 928 2864 896
WIRE 2976 928 2976 896
WIRE -496 944 -496 912
WIRE 304 1040 304 960
WIRE 752 1040 752 1008
FLAG 752 432 0
FLAG 752 0 VCC
IOPIN 752 0 In
FLAG 304 432 0
FLAG 1056 592 0
FLAG -176 208 HAI
IOPIN -176 208 In
FLAG -176 288 LAI
IOPIN -176 288 In
FLAG 912 176 FASE_A
IOPIN 912 176 Out
FLAG 752 1040 0
FLAG 752 608 VCC
IOPIN 752 608 In
FLAG 304 1040 0
FLAG -176 816 HBI
IOPIN -176 816 In
FLAG -176 896 LBI
IOPIN -176 896 In
FLAG 912 784 FASE_B
IOPIN 912 784 Out
FLAG -32 576 VCC
IOPIN -32 576 In
FLAG -1184 -80 triangular
FLAG -912 -80 pwm
FLAG -1056 160 0
FLAG -800 160 0
FLAG -1184 160 0
FLAG -912 160 0
FLAG -496 384 0
FLAG -496 576 0
FLAG -496 752 0
FLAG -496 944 0
FLAG -720 224 pwm
FLAG -720 608 pwm
FLAG -720 416 vdc
FLAG -720 800 vdc
FLAG -768 256 HA
IOPIN -768 256 In
FLAG -768 448 LA
IOPIN -768 448 In
FLAG -768 640 HB
IOPIN -768 640 In
FLAG -768 832 LB
IOPIN -768 832 In
FLAG -1248 608 HA
IOPIN -1248 608 Out
FLAG -1136 608 LA
IOPIN -1136 608 Out
FLAG -1024 608 HB
IOPIN -1024 608 Out
FLAG -928 608 LB
IOPIN -928 608 Out
FLAG -1248 720 0
FLAG -1136 720 0
FLAG -1024 720 0
FLAG -928 720 0
FLAG -1008 432 0
FLAG -1008 304 vdc
FLAG -384 240 HAI
IOPIN -384 240 Out
FLAG -384 432 LAI
IOPIN -384 432 Out
FLAG -384 624 HBI
IOPIN -384 624 Out
FLAG -384 816 LBI
IOPIN -384 816 Out
FLAG 2080 160 Fase_B
IOPIN 2080 160 In
FLAG 1296 160 Fase_A
IOPIN 1296 160 In
FLAG 2096 304 I_A
IOPIN 2096 304 Out
FLAG 2096 256 BEMF
IOPIN 2096 256 Out
FLAG 2096 512 Tmotor
IOPIN 2096 512 Out
FLAG 2096 624 wang
IOPIN 2096 624 In
FLAG 1296 592 I_A
IOPIN 1296 592 In
FLAG 1296 528 Fase_B
IOPIN 1296 528 In
FLAG 1296 480 BEMF
IOPIN 1296 480 In
FLAG 2096 672 Tmotor2
IOPIN 2096 672 Out
FLAG 1664 816 0
FLAG 2384 160 Tmotor2
IOPIN 2384 160 In
FLAG 2368 672 rpm
IOPIN 2368 672 Out
FLAG 2368 608 wang
IOPIN 2368 608 Out
FLAG 2912 608 theta_t
FLAG 2368 736 theta_t
IOPIN 2368 736 Out
FLAG 2368 800 theta
IOPIN 2368 800 Out
FLAG 2528 224 Tload
IOPIN 2528 224 In
FLAG 1072 288 0
FLAG 1072 128 Tload
IOPIN 1072 128 Out
FLAG 2928 432 theta_t
FLAG 2368 896 Tmotor
IOPIN 2368 896 Out
FLAG 1056 432 VCC
IOPIN 1056 432 Out
FLAG -32 -32 VCC
IOPIN -32 -32 In
FLAG 2864 928 0
FLAG 2976 928 0
SYMBOL PowerProducts\\LTC4446 304 208 R0
SYMATTR InstName U1
SYMBOL res 64 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value {Rin}
SYMBOL res 624 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {Rgate}
SYMBOL res 624 112 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value {Rgate}
SYMBOL nmos 704 48 R0
SYMATTR InstName M1
SYMATTR Value IRF1010N
SYMBOL res 64 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {Rin}
SYMBOL schottky 160 -16 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value 1N5819
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL cap 416 -48 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value {c_boot}
SYMBOL nmos 704 208 R0
SYMATTR InstName M2
SYMATTR Value IRF1010N
SYMBOL res 736 304 R0
SYMATTR InstName R5
SYMATTR Value {Rsense}
SYMBOL voltage 1056 448 R0
SYMATTR InstName VCC
SYMATTR Value 10V
SYMBOL PowerProducts\\LTC4446 304 816 R0
SYMATTR InstName U2
SYMBOL res 64 880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value {Rin}
SYMBOL res 624 880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value {Rgate}
SYMBOL res 624 720 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value {Rgate}
SYMBOL nmos 704 656 R0
SYMATTR InstName M3
SYMATTR Value IRF1010N
SYMBOL res 64 800 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value {Rin}
SYMBOL schottky 160 592 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value 1N5819
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL cap 416 560 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value {c_boot}
SYMBOL nmos 704 816 R0
SYMATTR InstName M4
SYMATTR Value IRF1010N
SYMBOL res 736 912 R0
SYMATTR InstName R10
SYMATTR Value {Rsense}
SYMBOL voltage -1184 16 R0
WINDOW 3 766 -152 Right 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 1 0 {1/(2*f_pwm)} {1/(2*f_pwm)} 0 {1/f_pwm})
SYMATTR InstName V1
SYMBOL voltage -1008 304 R0
SYMATTR InstName V4
SYMATTR Value 5
SYMBOL res -512 256 R0
SYMATTR InstName R11
SYMATTR Value 1G
SYMBOL res -512 448 R0
SYMATTR InstName R12
SYMATTR Value 1G
SYMBOL res -512 624 R0
SYMATTR InstName R13
SYMATTR Value 1G
SYMBOL res -512 816 R0
SYMATTR InstName R14
SYMATTR Value 1G
SYMBOL res -1040 160 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R15
SYMATTR Value 1G
SYMBOL res -784 160 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R16
SYMATTR Value 1G
SYMBOL Control\\mul -640 240 R0
SYMATTR InstName U3
SYMBOL Control\\mul -640 432 R0
SYMATTR InstName U4
SYMBOL Control\\mul -640 624 R0
SYMATTR InstName U5
SYMBOL Control\\mul -640 816 R0
SYMATTR InstName U6
SYMBOL bv -1136 592 R0
WINDOW 3 -68 214 Left 2
SYMATTR Value V=if(V(triangular)<0.5, 1, 0)
SYMATTR InstName B3
SYMBOL bv -1024 592 R0
WINDOW 3 -120 260 Left 2
SYMATTR Value V=if(V(triangular)<0.5, 0, 0)
SYMATTR InstName B4
SYMBOL bv -928 592 R0
WINDOW 3 -103 320 Left 2
SYMATTR Value V=if(V(triangular)>0.5, 1, 1)
SYMATTR InstName B5
SYMBOL ind 1488 176 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value {Lm}
SYMATTR SpiceLine Rser={Rm}
SYMBOL Control\\isense 1664 160 R0
SYMATTR InstName U7
SYMBOL bv 1792 160 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -30 85 VBottom 2
SYMATTR InstName B6
SYMATTR Value V=KV_EMF * V(wang)
SYMBOL Control\\sub2 1392 480 R0
SYMATTR InstName U8
SYMBOL Control\\mul 1616 496 R0
SYMATTR InstName U9
SYMBOL Control\\div 1840 512 R0
SYMATTR InstName U10
SYMBOL bv 1664 688 R0
SYMATTR InstName B7
SYMATTR Value V=KV_EMF * V(I_A)
SYMBOL Control\\sub2 2544 160 R0
SYMATTR InstName U11
SYMBOL Control\\constant 2656 288 R0
SYMATTR InstName U12
SYMATTR Value K=J
SYMBOL Control\\constant 2800 288 R0
SYMATTR InstName U13
SYMATTR Value K=B/J
SYMBOL Control\\div 2752 176 R0
SYMATTR InstName U14
SYMATTR Value eps=0
SYMBOL Control\\integ 2960 176 R0
SYMATTR InstName U15
SYMBOL Control\\integ 2848 432 R270
SYMATTR InstName U16
SYMBOL Control\\sub2 3056 304 R90
SYMATTR InstName U17
SYMBOL Control\\mul 2928 304 R0
SYMATTR InstName U18
SYMBOL Control\\gain 2608 672 R180
SYMATTR InstName U19
SYMATTR Value A=60/(2*pi)
SYMBOL res 2848 800 R0
SYMATTR InstName R18
SYMATTR Value 1G
SYMBOL voltage 1072 160 R0
SYMATTR InstName V2
SYMATTR Value 0.01
SYMBOL bv -1248 592 R0
WINDOW 3 -188 174 Left 2
SYMATTR Value V=if(V(triangular)>0.5, 1,0)
SYMATTR InstName B2
SYMBOL voltage -912 16 R0
WINDOW 3 431 -185 Right 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 5 0 10n 10n {duty*1/f_pwm} {1/f_pwm})
SYMATTR InstName V5
SYMBOL bv 2976 800 R0
SYMATTR InstName B1
SYMATTR Value V=KV_EMF*V(theta_t)
TEXT -88 -128 Left 2 ;Drivers de Potència
TEXT -1336 -224 Left 2 !.param f_pwm=32K duty=0.5
TEXT -1328 -192 Left 2 !.tran 0 10 0
TEXT -120 -200 Left 2 !.param Rin=33 Rgate=33 C_boot=1000n Rsense=1e-2
TEXT 1320 64 Left 2 !.param Lm =850u Rm=5
TEXT 2088 216 Left 0 ;per calcular la potència elèctrica
TEXT 2096 280 Left 0 ;aquest multiplicat per KV=KI
TEXT 2576 344 Left 2 !.param J=2.5e-4
TEXT 2576 368 Left 2 !.param B=1.04e-3
TEXT 1760 64 Left 2 !.param KV_EMF = 0.083
TEXT 2640 688 Left 2 ;60/2*pi
TEXT 1328 32 Left 1 ;Domini Elèctric
TEXT 1736 32 Left 1 ;Conversió mecànic a elèctric
TEXT 1320 688 Left 2 ;Conversió elèctric a mecànic
TEXT 2424 56 Left 2 ;Domini mecànic
RECTANGLE Normal 1712 352 1312 16 2
RECTANGLE Normal 2064 288 1728 16 2
RECTANGLE Normal 2064 848 1312 400 2
RECTANGLE Normal 3136 576 2416 80 2
RECTANGLE Normal 3136 976 2416 592 2
