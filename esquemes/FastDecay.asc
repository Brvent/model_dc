Version 4.1
SHEET 1 2532 804
WIRE -1920 -368 -1920 -384
WIRE -1648 -368 -1648 -384
WIRE -640 -320 -704 -320
WIRE -576 -320 -640 -320
WIRE -432 -320 -512 -320
WIRE -384 -320 -432 -320
WIRE -256 -320 -320 -320
WIRE -1920 -288 -1920 -368
WIRE -1840 -288 -1920 -288
WIRE -1648 -288 -1648 -368
WIRE -1552 -288 -1648 -288
WIRE -1920 -256 -1920 -288
WIRE -1648 -256 -1648 -288
WIRE 16 -240 16 -288
WIRE -1840 -224 -1840 -288
WIRE -1552 -224 -1552 -288
WIRE -432 -224 -432 -320
WIRE -640 -160 -640 -320
WIRE -560 -160 -640 -160
WIRE -208 -160 -304 -160
WIRE -32 -160 -128 -160
WIRE -1920 -128 -1920 -176
WIRE -1840 -128 -1840 -144
WIRE -1648 -128 -1648 -176
WIRE -1552 -128 -1552 -144
WIRE 768 -128 560 -128
WIRE 912 -128 848 -128
WIRE 1008 -128 944 -128
WIRE 1072 -128 1008 -128
WIRE 1344 -128 1152 -128
WIRE 1776 -128 1648 -128
WIRE 1984 -128 1840 -128
WIRE -256 -112 -256 -320
WIRE 16 -112 16 -144
WIRE 16 -112 -256 -112
WIRE 176 -112 16 -112
WIRE 336 -112 336 -160
WIRE 2192 -112 2064 -112
WIRE 2320 -112 2256 -112
WIRE 1984 -96 1968 -96
WIRE -768 -80 -912 -80
WIRE -560 -80 -688 -80
WIRE -256 -80 -256 -112
WIRE -256 -80 -304 -80
WIRE 16 -80 16 -112
WIRE -1408 -64 -1456 -64
WIRE 1808 -64 1808 -96
WIRE 1808 -64 1792 -64
WIRE -1232 -48 -1328 -48
WIRE -1120 -48 -1232 -48
WIRE -1408 -32 -1504 -32
WIRE 1008 -32 1008 -128
WIRE 1360 -32 1008 -32
WIRE -1232 -16 -1232 -48
WIRE 2320 -16 2320 -112
WIRE -768 0 -912 0
WIRE -560 0 -688 0
WIRE -208 0 -304 0
WIRE -32 0 -128 0
WIRE 336 0 336 -32
WIRE 1968 0 1968 -96
WIRE 1968 0 1952 0
WIRE 2160 0 2096 0
WIRE 928 16 928 -112
WIRE 1360 16 928 16
WIRE 2288 16 2240 16
WIRE -1744 32 -1744 16
WIRE 16 32 16 16
WIRE 2160 32 2112 32
WIRE 2112 80 2112 32
WIRE 2192 80 2112 80
WIRE -1232 96 -1232 64
WIRE 2112 112 2112 80
WIRE -1408 128 -1456 128
WIRE -1744 144 -1744 112
WIRE -1232 144 -1328 144
WIRE -1120 144 -1232 144
WIRE -432 144 -432 64
WIRE 16 144 16 112
WIRE 2192 144 2192 80
WIRE -1408 160 -1504 160
WIRE 336 160 336 128
WIRE -1232 176 -1232 144
WIRE 624 192 560 192
WIRE 848 192 688 192
WIRE 1072 208 928 208
WIRE 848 224 816 224
WIRE 1360 224 1152 224
WIRE 656 240 656 224
WIRE 656 240 560 240
WIRE 1072 240 1024 240
WIRE 2112 272 2112 176
WIRE 2320 272 2320 48
WIRE 2320 272 2112 272
WIRE -1232 288 -1232 256
WIRE -640 288 -784 288
WIRE -576 288 -640 288
WIRE -432 288 -512 288
WIRE -384 288 -432 288
WIRE -256 288 -320 288
WIRE 336 288 336 240
WIRE 816 304 816 224
WIRE 816 304 560 304
WIRE -1408 320 -1456 320
WIRE 2112 320 2112 272
WIRE 2112 320 1632 320
WIRE 2176 320 2144 320
WIRE -1232 336 -1328 336
WIRE -1120 336 -1232 336
WIRE 1024 336 1024 240
WIRE 1360 336 1024 336
WIRE -1408 352 -1504 352
WIRE -1232 352 -1232 336
WIRE 16 368 16 320
WIRE -432 384 -432 288
WIRE 1360 384 928 384
WIRE 1840 384 1632 384
WIRE 2112 384 2112 320
WIRE 2112 384 1904 384
WIRE 928 416 928 384
WIRE -1984 432 -1984 400
WIRE -1872 432 -1872 400
WIRE -1760 432 -1760 400
WIRE -1664 432 -1664 400
WIRE -640 448 -640 288
WIRE -560 448 -640 448
WIRE -208 448 -304 448
WIRE -32 448 -128 448
WIRE 2144 448 2144 320
WIRE 2144 448 1632 448
WIRE -1232 464 -1232 432
WIRE -256 496 -256 288
WIRE 16 496 16 464
WIRE 16 496 -256 496
WIRE 176 496 16 496
WIRE -1408 512 -1456 512
WIRE 2128 512 1632 512
WIRE 2240 512 2128 512
WIRE -1232 528 -1328 528
WIRE -1120 528 -1232 528
WIRE -768 528 -912 528
WIRE -560 528 -688 528
WIRE -256 528 -256 496
WIRE -256 528 -304 528
WIRE 16 528 16 496
WIRE 928 528 928 496
WIRE 2128 528 2128 512
WIRE 2240 528 2240 512
WIRE -1408 544 -1504 544
WIRE -1232 544 -1232 528
WIRE -768 608 -912 608
WIRE -560 608 -688 608
WIRE -208 608 -304 608
WIRE -32 608 -128 608
WIRE 1728 608 1632 608
WIRE 16 640 16 624
WIRE 2128 640 2128 608
WIRE 2240 640 2240 608
WIRE -1232 656 -1232 624
WIRE -432 752 -432 672
WIRE 16 752 16 720
FLAG 16 144 0
FLAG 16 -288 VCC
IOPIN 16 -288 In
FLAG -432 144 0
FLAG 336 288 0
FLAG -912 -80 HAI
IOPIN -912 -80 In
FLAG -912 0 LAI
IOPIN -912 0 In
FLAG 176 -112 FASE_A
IOPIN 176 -112 Out
FLAG 16 752 0
FLAG 16 320 VCC
IOPIN 16 320 In
FLAG -432 752 0
FLAG -912 528 HBI
IOPIN -912 528 In
FLAG -912 608 LBI
IOPIN -912 608 In
FLAG 176 496 FASE_B
IOPIN 176 496 Out
FLAG -784 288 VCC
IOPIN -784 288 In
FLAG -1920 -368 triangular
FLAG -1648 -368 pwm
FLAG -1840 -128 0
FLAG -1552 -128 0
FLAG -1920 -128 0
FLAG -1648 -128 0
FLAG -1232 96 0
FLAG -1232 288 0
FLAG -1232 464 0
FLAG -1232 656 0
FLAG -1456 -64 pwm
FLAG -1456 320 pwm
FLAG -1456 128 vdc
FLAG -1456 512 vdc
FLAG -1504 -32 HA
IOPIN -1504 -32 In
FLAG -1504 160 LA
IOPIN -1504 160 In
FLAG -1504 352 HB
IOPIN -1504 352 In
FLAG -1504 544 LB
IOPIN -1504 544 In
FLAG -1984 320 HA
IOPIN -1984 320 Out
FLAG -1872 320 LA
IOPIN -1872 320 Out
FLAG -1760 320 HB
IOPIN -1760 320 Out
FLAG -1664 320 LB
IOPIN -1664 320 Out
FLAG -1984 432 0
FLAG -1872 432 0
FLAG -1760 432 0
FLAG -1664 432 0
FLAG -1744 144 0
FLAG -1744 16 vdc
FLAG -1120 -48 HAI
IOPIN -1120 -48 Out
FLAG -1120 144 LAI
IOPIN -1120 144 Out
FLAG -1120 336 HBI
IOPIN -1120 336 Out
FLAG -1120 528 LBI
IOPIN -1120 528 Out
FLAG 1344 -128 Fase_B
IOPIN 1344 -128 In
FLAG 560 -128 Fase_A
IOPIN 560 -128 In
FLAG 1360 16 I_A
IOPIN 1360 16 Out
FLAG 1360 -32 BEMF
IOPIN 1360 -32 Out
FLAG 1360 224 Tmotor
IOPIN 1360 224 Out
FLAG 1360 336 wang
IOPIN 1360 336 In
FLAG 560 304 I_A
IOPIN 560 304 In
FLAG 560 240 Fase_B
IOPIN 560 240 In
FLAG 560 192 BEMF
IOPIN 560 192 In
FLAG 1360 384 Tmotor2
IOPIN 1360 384 Out
FLAG 928 528 0
FLAG 1648 -128 Tmotor2
IOPIN 1648 -128 In
FLAG 1632 384 rpm
IOPIN 1632 384 Out
FLAG 1632 320 wang
IOPIN 1632 320 Out
FLAG 2176 320 theta_t
FLAG 1632 448 theta_t
IOPIN 1632 448 Out
FLAG 1632 512 theta
IOPIN 1632 512 Out
FLAG 1792 -64 Tload
IOPIN 1792 -64 In
FLAG 336 0 0
FLAG 336 -160 Tload
IOPIN 336 -160 Out
FLAG 2192 144 theta_t
FLAG 1632 608 Tmotor
IOPIN 1632 608 Out
FLAG 336 128 VCC
IOPIN 336 128 Out
FLAG -704 -320 VCC
IOPIN -704 -320 In
FLAG 2128 640 0
FLAG 2240 640 0
SYMBOL PowerProducts\\LTC4446 -432 -80 R0
SYMATTR InstName U1
SYMBOL res -672 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value {Rin}
SYMBOL res -112 -16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {Rgate}
SYMBOL res -112 -176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value {Rgate}
SYMBOL nmos -32 -240 R0
SYMATTR InstName M1
SYMATTR Value IRF1010N
SYMBOL res -672 -96 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {Rin}
SYMBOL schottky -576 -304 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value 1N5819
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL cap -320 -336 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value {c_boot}
SYMBOL nmos -32 -80 R0
SYMATTR InstName M2
SYMATTR Value IRF1010N
SYMBOL res 0 16 R0
SYMATTR InstName R5
SYMATTR Value {Rsense}
SYMBOL voltage 336 144 R0
SYMATTR InstName VCC
SYMATTR Value 10V
SYMBOL PowerProducts\\LTC4446 -432 528 R0
SYMATTR InstName U2
SYMBOL res -672 592 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value {Rin}
SYMBOL res -112 592 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value {Rgate}
SYMBOL res -112 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value {Rgate}
SYMBOL nmos -32 368 R0
SYMATTR InstName M3
SYMATTR Value IRF1010N
SYMBOL res -672 512 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value {Rin}
SYMBOL schottky -576 304 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMATTR Value 1N5819
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL cap -320 272 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value {c_boot}
SYMBOL nmos -32 528 R0
SYMATTR InstName M4
SYMATTR Value IRF1010N
SYMBOL res 0 624 R0
SYMATTR InstName R10
SYMATTR Value {Rsense}
SYMBOL voltage -1920 -272 R0
WINDOW 3 861 -159 Right 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 1 0 {1/(2*f_pwm)} {1/(2*f_pwm)} 0 {1/f_pwm})
SYMATTR InstName V1
SYMBOL voltage -1744 16 R0
SYMATTR InstName V2
SYMATTR Value 5
SYMBOL res -1248 -32 R0
SYMATTR InstName R11
SYMATTR Value 1G
SYMBOL res -1248 160 R0
SYMATTR InstName R12
SYMATTR Value 1G
SYMBOL res -1248 336 R0
SYMATTR InstName R13
SYMATTR Value 1G
SYMBOL res -1248 528 R0
SYMATTR InstName R14
SYMATTR Value 1G
SYMBOL res -1824 -128 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R15
SYMATTR Value 1G
SYMBOL res -1536 -128 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R16
SYMATTR Value 1G
SYMBOL Control\\mul -1376 -48 R0
SYMATTR InstName U3
SYMBOL Control\\mul -1376 144 R0
SYMATTR InstName U4
SYMBOL Control\\mul -1376 336 R0
SYMATTR InstName U5
SYMBOL Control\\mul -1376 528 R0
SYMATTR InstName U6
SYMBOL bv -1872 304 R0
WINDOW 3 -114 235 Left 2
SYMATTR Value V=if(V(triangular)<0.5, 1, 0)
SYMATTR InstName B1
SYMBOL bv -1760 304 R0
WINDOW 3 -171 288 Left 2
SYMATTR Value V=if(V(triangular) > 0.5, 1, 0)
SYMATTR InstName B2
SYMBOL bv -1664 304 R0
WINDOW 3 -137 326 Left 2
SYMATTR Value V=if(V(triangular) < 0.5, 1, 0)
SYMATTR InstName B3
SYMBOL ind 752 -112 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value {Lm}
SYMATTR SpiceLine Rser={Rm}
SYMBOL Control\\isense 928 -128 R0
SYMATTR InstName U7
SYMBOL bv 1056 -128 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -30 85 VBottom 2
SYMATTR InstName B4
SYMATTR Value V=KV_EMF * V(wang)
SYMBOL Control\\sub2 656 192 R0
SYMATTR InstName U8
SYMBOL Control\\mul 880 208 R0
SYMATTR InstName U9
SYMBOL Control\\div 1104 224 R0
SYMATTR InstName U10
SYMBOL bv 928 400 R0
SYMATTR InstName B5
SYMATTR Value V=KV_EMF * V(I_A)
SYMBOL Control\\sub2 1808 -128 R0
SYMATTR InstName U11
SYMBOL Control\\constant 1920 0 R0
SYMATTR InstName U12
SYMATTR Value K=J
SYMBOL Control\\constant 2064 0 R0
SYMATTR InstName U13
SYMATTR Value K=B/J
SYMBOL Control\\div 2016 -112 R0
SYMATTR InstName U14
SYMATTR Value eps=0
SYMBOL Control\\integ 2224 -112 R0
SYMATTR InstName U15
SYMBOL Control\\integ 2112 144 R270
SYMATTR InstName U16
SYMBOL Control\\sub2 2320 16 R90
SYMATTR InstName U17
SYMBOL Control\\mul 2192 16 R0
SYMATTR InstName U18
SYMBOL Control\\gain 1872 384 R180
SYMATTR InstName U19
SYMATTR Value A=60/(2*pi)
SYMBOL res 2112 512 R0
SYMATTR InstName R18
SYMATTR Value 1G
SYMBOL voltage 336 -128 R0
SYMATTR InstName V3
SYMATTR Value 0.01
SYMBOL bv -1984 304 R0
WINDOW 3 -154 185 Left 2
SYMATTR Value V=if(V(triangular)>0.5, 1,0)
SYMATTR InstName B7
SYMBOL voltage -1648 -272 R0
WINDOW 3 480 -188 Right 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 5 0 10n 10n {duty*1/f_pwm} {1/f_pwm})
SYMATTR InstName V4
SYMBOL bv 2240 512 R0
SYMATTR InstName B8
SYMATTR Value V=KV_EMF*V(theta_t)
TEXT -824 -416 Left 2 ;Drivers de Potència
TEXT -2072 -512 Left 2 !.param f_pwm=32K duty=0.5
TEXT -2064 -480 Left 2 !.tran 0 10 0
TEXT -856 -488 Left 2 !.param Rin=33 Rgate=33 C_boot=1000n Rsense=1e-2
TEXT 584 -224 Left 2 !.param Lm =850u Rm=5
TEXT 1352 -72 Left 0 ;per calcular la potència elèctrica
TEXT 1360 -8 Left 0 ;aquest multiplicat per KV=KI
TEXT 1840 56 Left 2 !.param J=2.5e-4
TEXT 1840 80 Left 2 !.param B=1.04e-3
TEXT 1024 -224 Left 2 !.param KV_EMF = 0.083
TEXT 1904 400 Left 2 ;60/2*pi
TEXT 592 -256 Left 1 ;Domini Elèctric
TEXT 1000 -256 Left 1 ;Conversió mecànic a elèctric
TEXT 584 400 Left 2 ;Conversió elèctric a mecànic
TEXT 1688 -232 Left 2 ;Domini mecànic
RECTANGLE Normal 976 64 576 -272 2
RECTANGLE Normal 1328 0 992 -272 2
RECTANGLE Normal 1328 560 576 112 2
RECTANGLE Normal 2400 288 1680 -208 2
RECTANGLE Normal 2400 688 1680 304 2
